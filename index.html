<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Map & Daily Log</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex flex-col items-center p-4 bg-gray-50">
    <!-- Header - Now spans wider for the two-column view -->
    <header class="w-full max-w-3xl md:max-w-6xl bg-blue-700 text-white p-6 rounded-t-xl shadow-xl text-center">
        <h1 class="text-3xl font-extrabold mb-1">Daily Log & Life Map</h1>
        
        <!-- Editable Date and Count Inputs -->
        <div class="flex flex-wrap justify-center space-x-2 space-y-2 sm:space-y-0 text-sm mt-3">
            
            <!-- Date Input with Native Picker and Dynamic Weekday -->
            <div class="flex items-center space-x-1">
                <span class="font-medium">Date:</span>
                <input type="date" id="date-input" class="p-1 w-32 text-sm text-gray-800 rounded focus:ring-blue-300 focus:border-blue-300 border-none">
                <span id="weekday-display" class="text-sm"></span>
            </div>
            
            <!-- Consecutive Day Input with Custom Buttons -->
            <div class="flex items-center space-x-1">
                <span class="font-medium">Day:</span>
                <div class="flex items-stretch rounded overflow-hidden">
                    <button onclick="changeCount('consecutive-day-input', -1)" class="px-2 bg-gray-200 text-gray-800 hover:bg-gray-300 transition duration-150 font-bold text-base focus:outline-none focus:ring-2 focus:ring-gray-400 rounded-l-md">-</button>
                    <input type="number" id="consecutive-day-input" placeholder="32" class="p-1 w-10 text-sm text-gray-800 text-center count-input border-y border-gray-300 focus:ring-0 focus:border-gray-300">
                    <button onclick="changeCount('consecutive-day-input', 1)" class="px-2 bg-gray-200 text-gray-800 hover:bg-gray-300 transition duration-150 font-bold text-base focus:outline-none focus:ring-2 focus:ring-gray-400 rounded-r-md">+</button>
                </div>
            </div>

            <!-- Accumulated Count Input with Custom Buttons -->
            <div class="flex items-center space-x-1">
                <span class="font-medium">Count:</span>
                <div class="flex items-stretch rounded overflow-hidden">
                    <button onclick="changeCount('accumulated-count-input', -1)" class="px-2 bg-gray-200 text-gray-800 hover:bg-gray-300 transition duration-150 font-bold text-base focus:outline-none focus:ring-2 focus:ring-gray-400 rounded-l-md">-</button>
                    <input type="number" id="accumulated-count-input" placeholder="55" class="p-1 w-10 text-sm text-gray-800 text-center count-input border-y border-gray-300 focus:ring-0 focus:border-gray-300">
                    <button onclick="changeCount('accumulated-count-input', 1)" class="px-2 bg-gray-200 text-gray-800 hover:bg-gray-300 transition duration-150 font-bold text-base focus:outline-none focus:ring-2 focus:ring-gray-400 rounded-r-md">+</button>
                </div>
            </div>
        </div>

        <!-- Authentication Area -->
        <div class="mt-4 border-t border-blue-600 pt-3 flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-4">
            <p id="auth-status-display" class="text-sm font-medium">Authenticating...</p>
            <button id="auth-button" onclick="signInWithGoogle()" class="px-4 py-2 bg-white text-blue-700 rounded-lg font-bold hover:bg-gray-100 transition duration-150 shadow-md disabled:opacity-50" disabled>
                Sign in with Google
            </button>
        </div>
    </header>

    <!-- Status Message -->
    <div id="status-message" class="w-full max-w-3xl md:max-w-6xl p-3 text-center text-sm font-semibold rounded-t-none bg-yellow-100 text-yellow-800 hidden">
        Connecting to storage...
    </div>

    <!-- HISTORY SECTION (New position, Full-width band below header/status) -->
    <section id="history-section" class="w-full max-w-3xl md:max-w-6xl mx-auto p-5 rounded-b-xl border border-blue-200 bg-white shadow-xl mb-6">
        <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-300 pb-2 mb-4">ğŸ•°ï¸ Past Entries History</h2>
        
        <!-- DROPDOWN SELECT BOX -->
        <select id="history-dropdown" onchange="handleHistorySelect()">
            <option value="" disabled selected>Select a past entry...</option>
        </select>

        <!-- Status message specifically for the history loading -->
        <p id="history-status" class="text-gray-500 italic mt-2">Sign in to load history...</p>
        
    </section>

    <!-- MAIN CONTENT WRAPPER -->
    <div class="w-full max-w-3xl md:max-w-6xl mx-auto">
        
        <!-- MAIN CONTENT: Form and Output (Full Width of wrapper) -->
        <main class="w-full p-6 bg-white shadow-xl rounded-xl mb-8">
            
            <!-- Section 1: Story, Emotion, Gratitude, Reflection -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">âœ¨ Story, Emotion, Gratitude, Reflection</h2>
                <textarea id="reflection-entry" rows="16" placeholder="How was your day? What did you feel? What are you grateful for?"
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Section 2: Life Map (Daily Architecture) -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-2">ğŸ—ºï¸ Life Map (Daily Architecture)</h2>
                <p class="text-sm italic text-gray-500 mb-4">Log daily adherence and notes based on your routine.</p>
                <textarea id="life-map-log" rows="30" 
                          class="w-full p-3 border border-gray-300 rounded-lg text-sm font-mono-custom resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
                          placeholder="e.g., 06:40 - Morning Prep: Successful. 13:00 - Exercise: Jogged 30 mins.">
Time    Activity    Detail
06:40   Morning Prep
07:25   School Commute
08:30   Office Commute (Eng Practice/Finance)
09:30   Meditation
09:45   Breakfast
10:00   Work/Learning
12:00   Lunch/Rest
13:00   Exercise/Rest
14:00   Work Focus
16:30   End Day
18:30   Dinner
19:00   Older Daughter's Learning
19:50   Bathing
20:00   Bedtime Prep
20:30   Younger Daughter's Bedtime
21:30   Co-Sleeping
22:00   Laptop Setup
23:00   Evening Work
00:00   Exercise (Squat)
</textarea>
            </section>

            <!-- Section 3: Work Log - NOW DYNAMIC LIST -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">
                    ğŸ’¼ Work Log (Dynamic Tasks)
                    <button id="toggle-all-details-button" class="text-sm text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out ml-4">Collapse/Expand All</button>
                </h2>
                
                <!-- Container for dynamic task rows -->
                <div id="work-items-container" class="space-y-4 mb-4">
                    <!-- Default/Sample Item -->
                    <div class="work-item-container bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                        <div class="flex items-start space-x-3 mb-2">
                            <input type="checkbox" class="task-status-checkbox mt-1 w-5 h-5 text-green-600 border-gray-300 rounded focus:ring-green-500">
                            <input type="text" placeholder="Task Title (e.g., UFS error log capture)" 
                                   class="task-title-input w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-base font-medium">
                            <button onclick="moveWorkItemToTop(this)" class="text-gray-500 hover:text-gray-700 transition duration-150 text-xl font-bold p-1 leading-none" title="Move to Top">â«</button>
                            <button onclick="moveWorkItemUp(this)" class="text-gray-500 hover:text-gray-700 transition duration-150 text-xl font-bold p-1 leading-none" title="Move Up">â–²</button>
                            <button onclick="moveWorkItemDown(this)" class="text-gray-500 hover:text-gray-700 transition duration-150 text-xl font-bold p-1 leading-none" title="Move Down">â–¼</button>
                            <button onclick="moveWorkItemToBottom(this)" class="text-gray-500 hover:text-gray-700 transition duration-150 text-xl font-bold p-1 leading-none" title="Move to Bottom">â¬</button>
                            <button onclick="removeWorkItem(this)" class="text-red-500 hover:text-red-700 transition duration-150 text-xl font-bold p-1 leading-none" title="Remove Task">&times;</button>
                        </div>
                        <textarea rows="3" placeholder="Details (e.g., Fixed format to print error log. Implemented bootloader checking function.)" 
                                  class="task-detail-input w-full p-2 border border-gray-300 rounded-md text-sm resize-y focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>

                <button onclick="addWorkItem()" class="w-full py-2 px-4 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition duration-150 ease-in-out">
                    + Add Work Item
                </button>
            </section>
            
            <!-- Section 4: WEEK GOALS -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 id="week-goals-header" class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸ¯ Week Goals</h2>
                <p class="text-sm italic text-gray-500 mb-4">W44 goals and important plans.</p>
                <textarea id="week-goals-entry" rows="16" placeholder="Update on week goals and important plans..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- SECTION 5: GAMIFICATION NOTES -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸ’¡ Gamification Notes</h2>
                <p class="text-sm italic text-gray-500 mb-4">Core Drives, Octalysis ideas, or other motivational strategies.</p>
                <textarea id="gamification-notes-entry" rows="10" placeholder="Enter your gamification analysis or notes here..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Section 6: PERSONAL LONG TERM PLAN -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">â³ Personal Long Term Plan</h2>
                <textarea id="long-term-plan-entry" rows="10" placeholder="e.g., Performance App, Robot App, English movies, Japanese..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Section 7: PERSONAL SHORT TERM PLAN -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸš€ Personal Short Term Plan</h2>
                <textarea id="short-term-plan-entry" rows="6" placeholder="e.g., Set gamification for Cecilia..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>
            
            <!-- Section 8: ENGLISH PRACTICE -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸ‡¬ğŸ‡§ English Practice</h2>
                <textarea id="english-practice-entry" rows="6" placeholder="Log today's English learning activity and notes..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Section 9: JAPANESE PRACTICE -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸ‡¯ğŸ‡µ Japanese Practice</h2>
                <textarea id="japanese-practice-entry" rows="6" placeholder="Log today's Japanese learning, e.g., vocabulary, grammar, lyrics..."
                          class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Section 10: CUSTOM END NOTES (User-defined title) -->
            <section class="p-5 rounded-xl border border-gray-100 mb-6">
                <h2 class="text-xl text-blue-700 font-semibold border-b border-blue-100 pb-2 mb-4">ğŸ“ Custom Daily Notes Header</h2>
                <!-- Input for the user-defined Markdown Title -->
                <input type="text" id="custom-notes-title" placeholder="Enter the header title for the final entry (e.g., Final Checklist or New Ideas)"
                       class="w-full p-3 mb-4 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                <p class="text-sm italic text-gray-500 mb-4">Enter the content for this custom section below.</p>
                <textarea id="custom-notes-entry" rows="10" placeholder="Enter notes here..."
                      class="w-full p-3 border border-gray-300 rounded-lg text-base resize-y focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </section>

            <!-- Save Button now calls saveDiaryEntry -->
            <button id="save-button" onclick="saveDiaryEntry()" class="w-full py-4 bg-green-600 text-white font-bold text-lg rounded-xl transition-colors shadow-lg hover:bg-green-700 disabled:opacity-50" disabled>
                ğŸ’¾ Generate, Save & Copy Entry
            </button>
            
            <!-- Log Output -->
            <section id="output-section" class="mt-6">
                <h2 class="text-xl text-gray-800 font-semibold border-b border-gray-200 pb-2 mb-4">ğŸ“ Generated Entry (Copy/Paste)</h2>
                <textarea id="diary-output" rows="30" readonly 
                          class="w-full p-4 bg-gray-100 border-2 border-dashed border-gray-400 rounded-lg text-sm font-mono-custom resize-y" 
                          placeholder="Your formatted entry will appear here after you click 'Generate & Copy Entry'."></textarea>
            </section>
        </main>
    </div>

    <footer class="text-sm text-gray-500 mt-4 pb-8">
        <p>Built for the Life Map Logger &copy; 2025</p>
    </footer>

    <script type="module" src="script.js"></script>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab-main" id="fab-main-button">
            <span>+</span>
        </button>
        <div class="fab-menu">
            <button class="fab-item" id="fab-save-button" title="Save Diary">
                ğŸ’¾
            </button>
            <button class="fab-item" id="fab-copy-button" title="Copy Output">
                ğŸ“‹
            </button>
        </div>
    </div>
</body>
</html>